{"id": "enchantment-level-vs-bookshelf-part-iii", "title": "On Minecraft Enchantment Levels and Bookshelves Part III: The Changes in 1.3", "content": "The much anticipated 1.3 update for Minecraft is coming out soon, and along with a whole host of new additions to the game, it also brings an overhaul to the enchanting system. This, of course, completely changes the optimum enchanting level-bookshelf relations that I derived for the <a href=\"\">previous enchanting system</a>, just like the 1.1 update broke <a href=\"http://www.alphasheep.co.za/2011/12/on-enchantment-level-bookshelf.html\">the one before that</a>.<div class=\"readmore\"><br/><br/>I've been digging in the source for the 12w26a snapshot in order to find out what the changes are. To my knowledge, the calculations have not changed since the rebalancing introduced in the 12w22a snapshot released at the end of May. Comparing these to the snippets of source code I had saved from 1.1, I have worked out how the new enchanting levels are calculated.<br/><br/>But, before I get into that, let me once again reiterate why you'd want to understand the enchanting level-bookshelf relation. There are <a href=\"http://www.minecraftwiki.net/wiki/Enchantment_Mechanics#Enchantment_Simulator\">simulators</a> which can calculate the probability of getting a certain enchantment at a certain level (there is an excellent calculator <a href=\"http://pernsteiner.org/minecraft/enchant_snapshot/\">here</a>). This means that if you are looking for a specific enchantment or combination of enchantments, there is an optimum level that would maximise you chances of getting the combination of enchantments that you want. Of course, you can keep rolling new levels to find the level you want, but it is quicker to set the number of bookshelves so that the level you want is most likely to show up, especially if you tend to enchant at the same level every time.<br/><br/>Lets start by looking at the relevant changes as stated in the <a href=\"http://www.minecraftwiki.net/wiki/Version_history/Development_versions#12w22a\">version history</a> on the wiki:<br/><ul><li>\"The maximum enchantment level has been lowered from 50 to 30. As a result enchantment tables now require only 15 bookcases around them to allow maximum level enchantments.\"</li><li>\"With a full enchantment table set with bookshelves, at the bottom of the 3 enchantments, it always shows you the highest number possible\"</li></ul><br/>First, before we get into source code, let's try some in-game testing. The first point is definitely true. Level 30 is indeed the maximum level, and there is no difference in the distribution of levels with more than 15 bookshelves. Now testing the second point. With no bookshelves, it seems we are offered random levels in the bottom slot between 1 and 8. The first obvious difference is that maximum with no bookshelves has been upped from 5. Also it seems you are not always shown the highest number possible. In fact, with 5 bookshelves, you are offered levels between 10 and 15 in the bottom slot, and although 10 bookshelves usually offers level 20, it occasionally offers as high as level 23 in the bottom slot (as in the screenshot below). With 15 bookshelves, however, you always seem to be offered level 30 in the bottom slot. The second point, it seems, is indeed only true for a \"<i>full</i> enchantment table set\".<br/><br/><div style=\"clear: both; text-align: center;\"><a href=\"data/images/-8OieZL8-iQ.png\" imageanchor=\"1\" style=\"margin-left:1em; margin-right:1em\"><img border=\"0\" height=\"225\" src=\"data/images/-8OieZL8-iQ.png\" width=\"400\"/></a><br/><b>Figure 1</b>: Screenshot showing enchantment level 23 being offered with 10 bookshelves (which happens about 1.13% of the time)</div><br/><br/>So, what's actually happening in the source code? There are actually only 4 small changes in functionality between 1.1 and 12w26a. The relevant snippets of code (edited slightly to make them more readable) are:<br/><br/>- In version 1.1:<br/><span style=\"font-family: 'Courier New', Courier, monospace; font-size: small;\">\u00a0 \u00a0 if (nBookShelves &gt; 30) { nBookShelves = 30; }<br/>\u00a0 \u00a0 int level = random.nextInt(5) + 1 + (nBookShelves / 2) +<br/>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 random.nextInt(nBookShelves + 1);<br/>\u00a0 \u00a0 if (slotNum == 0) { return (level/2) + 1; }<br/>\u00a0 \u00a0 if (slotNum == 1) { return (level*2)/3 + 1; }<br/>\u00a0 \u00a0 else { return level; }</span><br/><br/>- and in snapshotn 12w26a:<br/><span style=\"font-family: 'Courier New', Courier, monospace; font-size: small;\">\u00a0 \u00a0 if (nBookShelves &gt; 15) { nBookShelves = 15; }<br/>\u00a0 \u00a0 int level = random.nextInt(8) + 1 + (nBookShelves /2) +<br/>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 random.nextInt(nBookShelves + 1);<br/>\u00a0 \u00a0 if (slotNum == 0) { return max(level/3, 1); }<br/>\u00a0 \u00a0 if (slotNum == 1) { return (level*2)/3 + 1; }<br/>\u00a0 \u00a0 else { return max(level, nBookShelves*2); }</span><br/><br/>The changes are:<br/><ol><li>The number of bookshelves is capped at 15, rather than 30.</li><li>The random modifier for the level is between 1 and 8, rather than 1 and 5.</li><li>The top slot shows one third of the calculated level, rather than one half.</li><li>The level offered in the bottom slot now has a lower bound equal to twice the number of bookshelves.</li></ol><br/>It is a fairly simple matter to use this to validate the upper and lower bounds for the enchantment levels that we find in-game. The table below shows what these upper and lower bounds are for each number of bookshelves.<br/><br/><div style=\"text-align: center; margin:0 auto;\"><table align=\"center\" border=\"1\" cellpadding=\"2\"><tr> <td style=\"text-align: center;\"><b>Shelves</b></td> <td style=\"text-align: center;\"><b>Top</b></td> <td style=\"text-align: center;\"><b>Middle</b></td> <td style=\"text-align: center;\"><b>Bottom</b></td></tr><tr><td>0</td><td>1-2</td><td>1-6</td><td>1-8</td></tr><tr><td>1</td><td>1-3</td><td>1-7</td><td>2-9</td></tr><tr><td>2</td><td>1-3</td><td>2-8</td><td>4-11</td></tr><tr><td>3</td><td>1-4</td><td>2-9</td><td>6-12</td></tr><tr><td>4</td><td>1-4</td><td>3-10</td><td>8-14</td></tr><tr><td>5</td><td>1-5</td><td>3-11</td><td>10-15</td></tr><tr><td>6</td><td>1-5</td><td>3-12</td><td>12-17</td></tr><tr><td>7</td><td>1-6</td><td>3-13</td><td>14-18</td></tr><tr><td>8</td><td>1-6</td><td>4-14</td><td>16-20</td></tr><tr><td>9</td><td>1-7</td><td>4-15</td><td>18-21</td></tr><tr><td>10</td><td>2-7</td><td>5-16</td><td>20-23</td></tr><tr><td>11</td><td>2-8</td><td>5-17</td><td>22-24</td></tr><tr><td>12</td><td>2-8</td><td>5-18</td><td>24-26</td></tr><tr><td>13</td><td>2-9</td><td>5-19</td><td>26-27</td></tr><tr><td>14</td><td>2-9</td><td>6-20</td><td>28-29</td></tr><tr><td>15</td><td>2-10</td><td>6-21</td><td>30</td></tr></table></div><br/>For the previous system, I plotted the distributions of levels offered in the bottom slot, but the bottom slot is now heavily skewed toward offering a level equal to twice the number of bookshelves. For instance, with 14 bookshelves, you will be offered a level 28 enchantment 99.2% of the time, with a level 29 enchantment only showing up an average of once every 120 tries. This makes odd levelled enchantments exceptionally difficult to obtain (although none is rarer than the level 50 enchantment was in the 1.1. enchanting system). It also makes a distribution graph look pretty stupid. Even so, I plotted it. Don't ask me why.<br/><br/><div style=\"clear: both; text-align: center;\"><a href=\"data/images/3MdJHFmGX_I.png\" imageanchor=\"1\" style=\"margin-left:1em; margin-right:1em\"><img border=\"0\" height=\"322\" src=\"data/images/3MdJHFmGX_I.png\" width=\"400\"/></a><br/><b>Figure 2</b>: Distribution of enchantment levels appearing in the bottom slot</div><br/>The optimum number of bookshelves to use to obtain a specific enchantment level is easy to calculate and is shown in the table below, together with the probability that that enchantment will be offered at that level.<br/><br/><div style=\"text-align: center; margin:0 auto;\"><table align=\"center\" border=\"1\" cellpadding=\"2\"><td> <b>Level</b> </td><td> <b>Shelves</b> </td><td> <b>Probability</b> </td><td>  1 </td><td> 0 </td><td> 71.3%</td><td>  2 </td><td> 1 </td><td> 55.6%</td><td>  3 </td><td> 2 </td><td> 40.6%</td><td>  4 </td><td> 2 </td><td> 34.4%</td><td>  5 </td><td> 2 </td><td> 34.4%</td><td>  6 </td><td> 3 </td><td> 50.8%</td><td>  7 </td><td> 3 </td><td> 31.6%</td><td>  8 </td><td> 4 </td><td> 55.0%</td><td>  9 </td><td> 4 </td><td> 23.4%</td><td>  10 </td><td> 5 </td><td> 70.1%</td><td>  11 </td><td> 10 </td><td> 18.2%</td><td>  12 </td><td> 6 </td><td> 73.7%</td><td>  13 </td><td> 12 </td><td> 15.4%</td><td>  14 </td><td> 7 </td><td> 84.4%</td><td>  15 </td><td> 14 </td><td> 13.3%</td><td>  16 </td><td> 8 </td><td> 86.1%</td><td>  17 </td><td> 15 </td><td> 10.2%</td><td>  18 </td><td> 9 </td><td> 92.5%</td><td>  19 </td><td> 15 </td><td> 5.5%</td><td>  20 </td><td> 10 </td><td> 93.2%</td><td>  21 </td><td> 10 </td><td> 3.4%</td><td>  22 </td><td> 11 </td><td> 96.9%</td><td>  23 </td><td> 11 </td><td> 2.1%</td><td>  24 </td><td> 12 </td><td> 97.1%</td><td>  25 </td><td> 12 </td><td> 1.9%</td><td>  26 </td><td> 13 </td><td> 99.1%</td><td>  27 </td><td> 13 </td><td> 0.9%</td><td>  28 </td><td> 14 </td><td> 99.2%</td><td>  29 </td><td> 14 </td><td> 0.8%</td><td>  30 </td><td> 15 </td><td> 100.0%</td></table></div><br/>Due to the rarity of high odd numbered levels, it is probably quicker for players to restrict themselves to the even number that gives the best probability for the combination of enchantments they want, rather than use an odd number with a slightly higher probability. As a rule of thumb, for even numbers, take half of the level you want, and use that many bookshelves. It's much easier than it was before.<br/><br/>[Source: minecraft.jar for versions 1.1 and snapshot 12w26a, decompiled with <a href=\"http://mcp.ocean-labs.de/index.php/Main_Page\">MCP</a> 5.6 and <a href=\"http://mcp.ocean-labs.de/index.php/Main_Page\">MCP</a> 6.15 respectively.]<br/><br/></div>", "published": "2012-07-30T16:06:00+02:00", "updated": "2013-03-01T11:13:39.319000+02:00", "draft": false, "categories": ["video game mechanics", "Minecraft", "mathematics"]}